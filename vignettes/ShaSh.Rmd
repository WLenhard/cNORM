
---
title: "Modelling Psychometric Data with Sinh-Arcsinh Distributions"
author: "Wolfgang Lenhard & Alexandra Lenhard"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Modelling Psychometric Data with Sinh-Arcsinh Distributions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60),
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

The Sinh-Arcsinh (ShaSh) distribution represents a powerful and flexible parametric approach for modeling psychometric norm data across age or other continuous predictors. Unlike traditional approaches that assume normality or require discrete score distributions, the ShaSh distribution can accommodate a wide range of distributional shapes. It was introduced by Jones and Pewsey (2009) as a generalization of the normal distribution that provides independent control over skewness and kurtosis. This flexibility makes it particularly well-suited for applications where score distributions often exhibit floor effects, ceiling effects, varying degrees of skewness, or heterogeneous populations with different tail behaviors. In contrast to Box Cox distributions, ShaSh can handle zeros and negative values as well.

The ShaSh distribution was introduced to cNORM in version 3.5. In this vignette, we present the mathematical foundation of the ShaSh distribution, discuss its advantages and prerequisites, demonstrate practical modeling applications, and provide guidance for choosing between different distributional approaches.


## Mathematical Foundation

The ShaSh distribution is based on a two-step transformation of the standard normal distribution, allowing independent control over distributional shape and location-scale characteristics. Is is a two-step approach, which separates shape control (Step 1) from location-scale adjustment (Step 2).


**Step 1: Shape Transformation**

If Y follows a standard normal distribution N(0,1), then the ShaSh-transformed variable Z is defined as:

\[Z = \sinh(\delta \cdot \text{arcsinh}(Y) + \epsilon)\]

This transformation controls the distributional shape through the parameters ε (skewness) and δ (tail weight).


**Step 2: Location-Scale Transformation**

The final ShaSh-distributed variable X is obtained by applying location and scale parameters:

\[X = \mu + \sigma \cdot Z\]

**Complete Transformation:**

\[Y \sim N(0,1) \rightarrow Z = \sinh(\delta \cdot \text{arcsinh}(Y) + \epsilon) \rightarrow X = \mu + \sigma \cdot Z\]

where:

- **μ** (mu): location parameter, shifts the distribution horizontally (similar to mean)

- **σ** (sigma): scale parameter (σ > 0), controls the spread of the distribution (similar to standard deviation)  

- **ε** (epsilon): skewness parameter (ε = 0 for symmetry, ε > 0 for right skew, ε < 0 for left skew)

- **δ** (delta): tail weight parameter (δ = 1 produces normal-like tails, δ > 1 produces heavier tails, δ < 1 produces lighter tails)


### Modelling Parameters over Age

In cNORM's ShaSh implementation, we model three of the four parameters as polynomial functions of standardized age:

\[\mu(\text{age}) = \alpha_0 + \alpha_1 \cdot \text{age}_{std} + \alpha_2 \cdot \text{age}_{std}^2 + \ldots + \alpha_m \cdot \text{age}_{std}^m\]

\[\log(\sigma(\text{age})) = \beta_0 + \beta_1 \cdot \text{age}_{std} + \beta_2 \cdot \text{age}_{std}^2 + \ldots + \beta_s \cdot \text{age}_{std}^s\]

\[\epsilon(\text{age}) = \gamma_0 + \gamma_1 \cdot \text{age}_{std} + \gamma_2 \cdot \text{age}_{std}^2 + \ldots + \gamma_t \cdot \text{age}_{std}^t\]

The tail weight parameter δ is typically held constant across ages in the current implementation, though it can be adjusted to reflect population characteristics.


## Advantages and Applications

Key advantages of the Sinh-Arcsinh distribution include:

**1. Distributional Flexibility**: The ShaSh distribution can model symmetric and asymmetric distributions with varying tail weights, making it suitable for diverse psychometric applications.

**2. Continuous Scores**: Unlike discrete distributions (e.g., beta-binomial), ShaSh naturally handles continuous scores, decimal values, and unbounded measures.

**3. Zero and Negative Values**: ShaSh can accommodate scores of zero and negative values without transformation, unlike Box-Cox approaches that require strictly positive data.


It is particularly well-suited for:

- **Continuous performance measures** (reaction times, achievement scores with decimal precision)
- **Tests with floor or ceiling effects** where skewness varies across age groups
- **Change or difference scores** that may include negative values
- **Adaptive tests** or measures with variable stopping rules
- **Large-scale assessments** where distributional assumptions are complex


## Prerequisites and Considerations

### Data Requirements

**Continuous Trajectories**: Scores should exhibit systematic (though not necessarily monotonic) development across the predictor variable.

**Sufficient Sample Size**: We recommend a minimum of 100 cases per major age group, with larger samples needed for higher polynomial degrees or complex developmental patterns. There is - however - no clear
prove of this rule of thumb available yet, but these case number worked in Lenhard et al. (2019).

**Score Characteristics**: While ShaSh handles continuous scores optimally, it can also model discrete scores effectively, especially when the number of possible values is large.

**Representativeness**: The sample should be representative of the target population, though post-stratification weighting can help address moderate deviations.

### Model Selection Considerations

**Polynomial Degrees**: Choose polynomial degrees based on:

- Theoretical expectations about developmental trajectories

- Sample size (higher degrees require more data)

- Model comparison criteria (AIC, BIC)

- Visual inspection of fitted curves

**Delta Parameter**: The tail weight parameter should reflect population characteristics:

- δ = 0.7-0.9: Homogeneous, places emphasis on the central body of the distributions

- δ = 1.0: General population samples

- δ = 1.2-2.0: Heterogeneous populations, emphases tail behavior


## Modeling Example

We demonstrate ShaSh modeling using the PPVT-4 vocabulary development dataset. This example showcases the distribution's ability to handle the complex developmental patterns and distributional characteristics typical of psychometric data. The code is not executed here due to computational intensity, but can be run in an R environment with the cNORM package installed.

### Data Exploration

```{r fig0, fig.height = 4, fig.width = 7, eval=FALSE}
library(cNORM)

# Examine the data structure and distribution
str(ppvt)
plot(ppvt$age, ppvt$raw, main="PPVT Raw Scores by Age", 
     xlab="Age", ylab="Raw Score", pch=16, alpha=0.6)

# Examine distributional characteristics by age groups
hist(ppvt$raw, breaks=30, main="Distribution of Raw Scores", 
     xlab="Raw Score", probability=TRUE)
```

The vocabulary development data shows the characteristic curvilinear growth pattern with potential distributional changes across age groups, making it an ideal candidate for ShaSh modeling.

### Basic Model Fitting

```{r fig1, fig.height = 4, fig.width = 7, eval=FALSE}
# Fit ShaSh model with default settings. 
# The function automatically displays percentile plots.
model.shash <- cnorm.shash(age = ppvt$age, score = ppvt$raw)

```

The model uses reasonable default values for polynomial degrees and provides visual feedback through percentile plots. The output shows the fitted parameters and convergence information. In case of more
complex data patterns, consider adjusting polynomial degrees of mu, sigma and epsilon and changing the delta parameter.

### Model Diagnostics

```{r, eval=FALSE}
# Obtain detailed diagnostics
summary(model.shash, age = ppvt$age, score = ppvt$raw)
```

The summary provides comprehensive fit statistics, parameter estimates with significance tests, and model comparison metrics. Pay attention to the R-squared values and examine residual patterns for model adequacy.

### Custom Model Specifications

For more complex developmental patterns, you can adjust the polynomial degrees and tail weight parameter:

```{r, eval=FALSE}
# Fit model with custom parameters
model.custom <- cnorm.shash(age = ppvt$age, score = ppvt$raw,
                           mu_degree = 2,        # Quadratic location pattern
                           sigma_degree = 1,     # Variability changing linearly  
                           epsilon_degree = 1,   # Skewness changing linearly
                           delta = 1.2)          # Slightly heavy tails

# Compare models
compare(model.shash, model.custom, age = ppvt$age, score = ppvt$raw,
        title = "ShaSh Model Comparison")
```

### Weighted Modeling

ShaSh models support post-stratification weighting, similar to other cNORM approaches:

```{r, eval=FALSE}
# Calculate weights for representative sampling
margins <- data.frame(variables = c("sex", "sex", "migration", "migration"),
                     levels = c(1, 2, 0, 1),
                     share = c(.52, .48, .7, .3))

weights <- computeWeights(ppvt, margins)

# Fit weighted model
model.weighted <- cnorm.shash(ppvt$age, ppvt$raw, weights = weights,
                             title = "Weighted ShaSh Model")
```

## Norm Score Generation

### Individual Predictions

```{r, eval=FALSE}
# Generate norm scores for specific ages and raw scores
ages <- c(10.25, 10.75, 11.25, 11.75)
raw_scores <- c(180, 185, 190, 195)

norm_scores <- predict(model.shash, ages, raw_scores)
print(data.frame(Age = ages, Raw_Score = raw_scores, Norm_Score = norm_scores))
```

### Comprehensive Norm Tables

```{r, eval=FALSE}
# Generate detailed norm tables
tables <- normTable.shash(model.shash, 
                         ages = c(10.25, 10.75), 
                         start = 150, 
                         end = 220,
                         step = 1,
                         CI = 0.95, 
                         reliability = 0.94)

# Display portion of first table
head(tables[[1]], 10)
```

The norm tables provide raw scores, probabilities, percentiles, z-scores, norm scores, and confidence intervals when reliability is specified.

## Model Comparison and Selection

### Comparing Different Approaches

```{r, eval=FALSE}
# Fit different model types for comparison
model.bb <- cnorm.betabinomial(ppvt$age, ppvt$raw, n = 228)
model.taylor <- cnorm(group = ppvt$group, raw = ppvt$raw, age = ppvt$age)

# Visual comparison
compare(model.shash, model.bb, age = ppvt$age, score = ppvt$raw,
        title = "ShaSh vs. Beta-Binomial Comparison")

compare(model.taylor, model.shash, age = ppvt$age, score = ppvt$raw,
        title = "Distribution free vs. ShaSh Comparison")
```

### Selection Criteria

When choosing between modeling approaches, consider:

**Use ShaSh when:**

- Scores are continuous or have many possible values

- Distributions show complex skewness patterns across age

- Floor/ceiling effects are present

- Population heterogeneity varies with age

- Zero or negative scores are possible


**Use Beta-Binomial when:**

- Scores represent discrete item counts

- Clear maximum score exists

- Test is unspeeded with binary scoring

- Typical use case are 1PL IRT based psychometric tests


**Use distribution free cNORM models when:**

- Maximum flexibility is needed

- Distributional assumptions are uncertain

- Distribution free models based on Taylor polynomials are in most cases very 
  efficient and show a very good fit. They are the preferable approach, when no
  specific distributional characteristics are expected.



## References

Jones, M. C., & Pewsey, A. (2009). Sinh-arcsinh distributions. *Biometrika*, 96(4), 761-780.

Lenhard, A., Lenhard, W., Gary, S. (2019). Continuous norming of psychometric tests: A simulation study of parametric and semi-parametric approaches. *PLoS ONE*, 14(9),  e0222279. https://doi.org/10.1371/journal.pone.0222279

Rigby, R. A., & Stasinopoulos, D. M. (2005). Generalized additive models for location, scale and shape. *Journal of the Royal Statistical Society: Series C*, 54(3), 507-554.
